---
import Layout from "@/layouts/Layout.astro"
import LogoPredy from "@/components/LogoPredy.astro"
import "@/styles/split-layout-new.css"

const itemArt = [
  {
    label: "Showreel",
    link: "arte/showreel",
    description: "Motion Design & Visual Effects",
    icon: "üé¨",
  },
  {
    label: "Digital Art",
    link: "arte/ilustraciones",
    description: "Ilustraci√≥n Digital & Concept Art",
    icon: "üé®",
  },
  {
    label: "Motion Graphics",
    link: "arte/motion-graphics",
    description: "Animaci√≥n & Dise√±o en Movimiento",
    icon: "‚ú®",
  },
  {
    label: "3D Universe",
    link: "arte/3d",
    description: "Modelado & Animaci√≥n 3D",
    icon: "üåå",
  },
  {
    label: "AI Creations",
    link: "arte/ia",
    description: "Arte Generativo & Experimentaci√≥n",
    icon: "ü§ñ",
  },
  {
    label: "Urban Art",
    link: "arte/graffiti",
    description: "Graffiti & Arte Urbano",
    icon: "üé®",
  },
]

const itemMusic = [
  {
    label: "Music Videos",
    link: "musica/videoclips",
    description: "Videoclips Oficiales",
    year: "2024",
    icon: "üé•",
  },
  {
    label: "PredyTube",
    link: "musica/predytube",
    description: "Contenido Exclusivo",
    year: "2024",
    icon: "üì∫",
  },
  {
    label: "Discograf√≠a",
    link: "musica/discos",
    description: "√Ålbumes & Singles",
    year: "2023",
    icon: "üíø",
  },
  {
    label: "Live Shows",
    link: "musica/conciertos",
    description: "Directos & Festivales",
    year: "2024",
    icon: "üé™",
  },
  {
    label: "Press",
    link: "musica/recortes-de-prensa",
    description: "Medios & Entrevistas",
    year: "2024",
    icon: "üì∞",
  },
  {
    label: "Behind The Scenes",
    link: "musica/extras",
    description: "Contenido Backstage",
    year: "2024",
    icon: "üé¨",
  },
]

const featuredArt = {
  title: "",
  project: "Dise√±os e ilustraciones",
  description: "Una fusi√≥n entre arte tradicional e inteligencia artificial",
  thumbnail: `${import.meta.env.PUBLIC_BASE_PATH}images/Header-Arte.jpg`,
}

const featuredMusic = {
  title: "",
  track: "M√∫sica y eventos",
  description: "Nuevo √°lbum disponible en todas las plataformas",
  thumbnail: `${import.meta.env.PUBLIC_BASE_PATH}images/Header-Music.jpg`,
}
---

<Layout title="La historia de Predy">
  <!-- HERO CON LOGO GRANDE CENTRADO -->
  <header class="flex flex-col h-dvh justify-center items-center">
    <div class="w-full text-center flex flex-col align-bottom">
      <div class="page-header-text">
        <h1 class="page-title text-[#fcd301] text-4xl">La historia de Predy</h1>
        <p
          class="page-subtitle bg-[#392e7b] px-4 py-1 mt-1 rotate-1.5 text-white inline-block"
        >
          Un viaje a trav√©s del arte y la m√∫sica del artista
        </p>
      </div>
    </div>
    <section class="hero-section">
      <div class="hero-logo-wrapper">
        <LogoPredy
          class="hero-logo w-96 h-auto -rotate-4 fill-[#fcd301] text-[#392e7b] stroke-[60]"
        />
      </div>
    </section>

    <!-- HEADER FIJO CON LOGO + MEN√ö -->
    <header class="site-header">
      <div class="site-header-inner flex justify-between items-center">
        <span class="inline-block w-1/3"></span>
        <span class="inline-block w-1/3">
          <a href="/" class="logo-shell" aria-label="Volver al inicio">
            <LogoPredy
              class="header-logo w-40 h-auto -rotate-3 fill-[#fcd301] text-[#392e7b] stroke-[40]"
            />
          </a>
        </span>
        <span class="w-1/3 flex justify-end">
          <nav
            id="predyHeader"
            class="main-nav max-w-1/3 flex items-end justify-end text-center rounded-md w-fit gap-5 mr-8 px-6 cursor-pointer bg-[#392e7b]/70 border-2 border-[#392e7b] py-2"
            aria-label="Secciones principales"
          >
            <a href="/arte" class="nav-link cursor-pointer">Arte</a>
            <a href="/musica" class="nav-link cursor-pointer">M√∫sica</a>
            <a href="/sobre-mi" class="nav-link cursor-pointer">Sobre m√≠</a>
            <a href="/otros" class="nav-link cursor-pointer">Otros</a>
          </nav>
        </span>
      </div>
    </header>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <section class="split-container">
    <div class="noise-overlay" aria-hidden="true"></div>

    <!-- Art Section -->
    <section class="art-section">
      <div class="section-background">
        <div class="gradient-sphere"></div>
      </div>

      <div class="section-content">
        <header class="section-header">
          <h2 class="art-title">Arte</h2>
          <p class="section-subtitleArte">
            Explorando los l√≠mites del arte digital
          </p>
          <p class="section-subtitle-symbols">
            Estos son simbolos de la secion de arte
          </p>
        </header>

        <div class="object-fill flex justify-end">
          <img
            src={featuredArt.thumbnail}
            alt="Featured artwork"
            class="featured-image"
          />
        </div>

        <div class="content-grid">
          {
            itemArt.map((item) => (
              <a href={item.link} class="grid-item art-item">
                <span class="item-icon">{item.icon}</span>
                <h3 class="item-title">{item.label}</h3>
                <p class="item-description">{item.description}</p>
                <span class="hover-indicator" />
              </a>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Music Section -->
    <section class="music-section">
      <div class="section-background">
        <div class="gradient-sphere music-sphere"></div>
      </div>

      <div class="section-content">
        <header class="section-header">
          <h2 class="music-title">M√∫sica</h2>
          <p class="section-subtitle">
            La fusi√≥n perfecta entre ritmo y poes√≠a
          </p>
          <p class="section-subtitle-symbols">
            Estos son simbolos de la secion de musica
          </p>
        </header>

        <div class="object-fill">
          <img
            src={featuredMusic.thumbnail}
            alt="Featured music"
            class="featured-image"
          />
        </div>

        <div class="content-grid">
          {
            itemMusic.map((item) => (
              <a href={item.link} class="grid-item music-item">
                <span class="item-icon">{item.icon}</span>
                <h3 class="item-title">{item.label}</h3>
                <p class="item-description">{item.description}</p>
                <span class="year-tag">{item.year}</span>
                <span class="hover-indicator" />
              </a>
            ))
          }
        </div>
      </div>
    </section>
  </section>

  <section class="w-full h-dvh flex justify-center items-center">
    CONTENIDO EXTRA
  </section>

  <footer class="text-center text-sm text-white bg-[#5c4da9] p-16">
    &copy; {new Date().getFullYear()} Predy. Todos los derechos reservados.
  </footer>

  <style is:global>
    @font-face {
      font-family: "Fast Blaze";
      src: url("http://localhost:4321/newWeb/fonts/fast-blaze.regular.otf")
        format("opentype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
  </style>

  <style>
    /* HERO */
    .hero-section {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-logo-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-logo {
      transform-origin: center;
      transition:
        transform 0.22s ease-out,
        opacity 0.22s ease-out;
    }

    /* HEADER FIJO */
    .site-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 40;
      pointer-events: none;
    }

    .site-header-inner {
      margin-inline: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo-shell {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header-logo {
      transform-origin: left center;
      view-transition-name: logo-predy;
      opacity: 0;
      transform: scale(0.7) translateY(-12px);
      display: none;
      transition:
        transform 0.35s ease-out,
        opacity 0.35s ease-out;
    }

    .main-nav {
      display: flex;
      gap: 1.25rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 0.8rem;
      opacity: 0;
      transform: translateY(6px);
      pointer-events: none;
      transition:
        opacity 0.35s ease-out,
        transform 0.35s ease-out;
    }

    /* El ID predyHeader usa la fuente display */
    #predyHeader {
      font-family: var(--font-display);
    }

    :root.header-sticky .hero-logo {
      opacity: 0;
      transform: scale(0.3);
      display: none;
    }

    :root.header-sticky .header-logo {
      opacity: 1;
      transform: scale(1) translateY(0);
      display: block;
    }

    :root.header-sticky .main-nav {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .nav-link {
      position: relative;
      padding-inline: 0.5rem;
      border-radius: 10px;
      color: #fcd301;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      overflow: visible;
    }
    .nav-link a:hover {
      font-weight: bold;
    }

    .nav-link::after {
      content: "";
      position: absolute;
      left: 50%;
      margin-top: 1.3rem;
      width: 60%;
      height: 1.3px;
      border-radius: 10px;
      background: white;
      opacity: 0;
      transform: translateX(-50%) scaleX(0);
      transform-origin: center;
      font-weight: bold;
    }

    .nav-link--active::after {
      animation: navUnderlineBounce 0.35s cubic-bezier(0.34, 1.56, 0.64, 1)
        forwards;
      opacity: 1;
    }

    .nav-link:focus-visible {
      outline: none;
    }

    .noise-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url("/noise.png") repeat;
      opacity: 0.03;
      pointer-events: none;
      z-index: 10;
    }

    /* Floating emojis (si los usas) */
    .floating-emoji {
      font-size: 1.5rem;
      position: absolute;
      animation: float 20s ease-in-out infinite;
      opacity: 0.5;
    }

    @keyframes float {
      0%,
      100% {
        transform: translate(0, 0) rotate(0deg);
      }
      25% {
        transform: translate(20px, -20px) rotate(90deg);
      }
      50% {
        transform: translate(-20px, -40px) rotate(180deg);
      }
      75% {
        transform: translate(-40px, -20px) rotate(270deg);
      }
    }

    @media (max-width: 768px) {
      .site-header-inner {
        gap: 0.75rem;
      }

      .main-nav {
        gap: 0.5rem;
        font-size: 0.7rem;
        letter-spacing: 0.11em;
      }

      .hero-logo {
        width: 16rem;
      }

      .header-logo {
        width: 11rem;
      }
    }
  </style>
</Layout>

<script>
  if (typeof window !== "undefined") {
    const heroLogo = document.querySelector(".hero-logo") as HTMLElement | null
    const siteHeader = document.querySelector(
      ".site-header"
    ) as HTMLElement | null
    const mainNav = document.querySelector(".main-nav") as HTMLElement | null
    const navLinks = Array.from(
      document.querySelectorAll<HTMLAnchorElement>("#predyHeader .nav-link")
    )

    let activeNavLink: HTMLAnchorElement | null = null
    let isHeaderSticky = false
    let triggerY: number | null = null

    const activateNavLink = (link: HTMLAnchorElement) => {
      if (activeNavLink === link) {
        link.classList.remove("nav-link--active")
        void link.offsetWidth
      } else if (activeNavLink) {
        activeNavLink.classList.remove("nav-link--active")
      }

      activeNavLink = link
      link.classList.add("nav-link--active")
    }

    navLinks.forEach((link) => {
      link.addEventListener("pointerenter", () => activateNavLink(link))
      link.addEventListener("focus", () => activateNavLink(link))
    })

    const computeTriggerY = () => {
      if (!heroLogo) return

      const wasSticky = isHeaderSticky

      if (wasSticky) {
        document.documentElement.classList.remove("header-sticky")
      }

      const rect = heroLogo.getBoundingClientRect()
      const scrollY = window.scrollY || window.pageYOffset || 0
      triggerY = rect.top + scrollY

      if (wasSticky) {
        document.documentElement.classList.add("header-sticky")
      }
    }

    const updateStickyState = () => {
      if (!siteHeader || !mainNav || !heroLogo || triggerY == null) return

      const scrollY = window.scrollY || window.pageYOffset || 0

      const shouldBeSticky = scrollY >= triggerY

      if (shouldBeSticky === isHeaderSticky) return

      const applyState = () => {
        isHeaderSticky = shouldBeSticky
        document.documentElement.classList.toggle(
          "header-sticky",
          shouldBeSticky
        )
        siteHeader.style.pointerEvents = shouldBeSticky ? "auto" : "none"
      }

      const anyDocument = document as any

      if (!anyDocument.startViewTransition) {
        applyState()
      } else {
        anyDocument.startViewTransition(applyState)
      }
    }

    window.addEventListener("scroll", updateStickyState, { passive: true })

    window.addEventListener("resize", () => {
      computeTriggerY()
      updateStickyState()
    })

    window.addEventListener("load", () => {
      computeTriggerY()
      updateStickyState()
    })

    computeTriggerY()
    updateStickyState()
  }
</script>
